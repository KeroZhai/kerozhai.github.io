<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="author" content="Keroz"><meta http-equiv="X-UA-Compatible" content="chrome=1"><meta name="revisit-after" content="7 days"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.ico" type="image/svg+xml"><meta name="msapplication-TileColor" content="#ffffff"><meta name="theme-color" content="#ffffff"><link href="https://fonts.googleapis.com/css2?family=Fira+Code&amp;family=Inter:wght@200;400;600&amp;display=swap" rel="stylesheet"><title>Git Flow - Keroz</title><script>!function(){var e=sessionStorage.getItem("redirect"),e=(e&&e!==location.href&&(sessionStorage.removeItem("redirect"),history.replaceState(null,null,e)),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches),t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" crossorigin="" src="/assets/app.b7859f7e.js"></script><link rel="modulepreload" href="/assets/vendor.81da9120.js"><link rel="stylesheet" href="/assets/app.0429677b.css"><link rel="modulepreload" crossorigin="" href="/assets/git-flow.146e3c10.js"><meta property="og:title" content="Git Flow"><meta property="og:description" content="一个经典的 Git 分支模型"><meta name="description" content="一个经典的 Git 分支模型"><meta name="head:count" content="3"></head><body class="font-sans text-gray-700 dark:text-gray-200"><div id="app" data-server-rendered="true"><!--[--><header class="header z-40" data-v-160206ad=""><a href="/" class="w-10 h-10 absolute lg:fixed m-6 select-none outline-none" focusable="false" data-v-160206ad=""></a><nav class="nav" data-v-160206ad=""><div class="spacer" data-v-160206ad=""></div><div class="right" data-v-160206ad=""><a href="/posts" class="" data-v-160206ad=""><span class="lt-md:hidden" data-v-160206ad="">Blog</span><svg style="vertical-align:sub" class="inline md:hidden" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" width="1.2em" height="1.2em" data-v-160206ad=""><path fill="currentColor" d="M20 22H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h16a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1zm-1-2V4H5v16h14zM7 6h4v4H7V6zm0 6h10v2H7v-2zm0 4h10v2H7v-2zm6-9h4v2h-4V7z"></path></svg></a><a class="select-none" title="Toggle Color Scheme" data-v-160206ad=""><svg style="vertical-align:sub;display:none" class="inline" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938A7.999 7.999 0 0 0 4 12z"></path></svg><svg style="vertical-align:sub" class="inline" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path fill="currentColor" d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05L3.515 4.93zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414l-2.121-2.121zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414l2.121-2.121zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414l2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"></path></svg></a></div></nav></header><main class="px-7 py-10"><!--[--><div class="prose m-auto mb-8"><h1>Git Flow</h1><p class="opacity-50 !-mt-2">Published at 15:20</p><div class="text-sm"><!--[--><a href="/posts?tag=git" class="tag-link" data-v-2eea5d08="">#git</a><a href="/posts?tag=translation" class="tag-link" data-v-2eea5d08=""> #translation</a><!--]--></div></div><article><div class="prose m-auto"><!--[--><blockquote><p>翻译自 <a href="https://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a>，有删改。</p></blockquote><h1 id="%E4%B8%BB%E8%A6%81%E5%88%86%E6%94%AF" tabindex="-1">主要分支 <a class="header-anchor" href="#%E4%B8%BB%E8%A6%81%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h1><p>远端仓库有两个一直存在的主要分支：</p><ul><li><code>main</code>（或 <code>master</code>）</li><li><code>dev</code>（或 <code>develop</code>）</li></ul><p><code>origin/main</code> 分支被视为主分支，其中的代码应当总是生产环境就绪的。</p><p><code>origin/dev</code> 分支被视为开发分支，其中包含了最新的变更，以供下一个版本发布。此分支有时也被叫做“集成分支”，因为通常 nightly builds 由此自动构建。</p><p>当 <code>dev</code> 分支上面的代码到达了某个稳定的节点并可供发布时，所有的变更都应当通过某种方式合入 <code>main</code> 分支，并打上一个版本号标签。后面会详细讨论如何完成这项工作。</p><p>因此，每当变更被合入到 <code>main</code> 分支后，这从<em>定义上</em>来说即是一个新的生产环境发布版本。理论上来说，我们可以使用 Git 钩子脚本，实现每当 <code>main</code> 分支上有新的提交时，自动构建、部署代码到生产环境。</p><h1 id="%E6%94%AF%E6%92%91%E5%88%86%E6%94%AF" tabindex="-1">支撑分支 <a class="header-anchor" href="#%E6%94%AF%E6%92%91%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h1><p>除了上述两个分支外，我们也会使用多种支撑分支：</p><ul><li>特性（Feature）分支</li><li>发布（Release）分支</li><li>热更（Hotfix）新分支</li></ul><p>不同于主要分支，这些分支不会一直存在，最终会被删除。</p><p>每个分支都有特定的目的，并且需要严格约束它们应创建自哪些分支以及最终要合入哪些分支。</p><p>在技术上来说，这些分支并没有什么特殊的地方，我们只是根据如何<em>使用</em>它们来进行分类。</p><h2 id="%E7%89%B9%E6%80%A7%E5%88%86%E6%94%AF" tabindex="-1">特性分支 <a class="header-anchor" href="#%E7%89%B9%E6%80%A7%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h2><p>创建自：</p><p><code>dev</code></p><p>必须合入：</p><p><code>dev</code></p><p>分支命名规则：</p><p>除了 <code>main</code>（或 <code>master</code>）、<code>dev</code>（或 <code>develop</code>）、<code>release-*</code>、<code>hotfix-*</code> 等以外的任何名称，最好能直接体现出特性。</p><p>特性分支被用来为后续发布开发新功能。在特性开发之初，尚不确定此特性要被包含在哪个目标发布版本中。只要特性还在开发当中，此分支就会一直存在，但最终会被合入到 <code>dev</code> 分支或被废弃。</p><blockquote><p>一般来说，特性分支只会在开发人员的本地仓库中存在，而非远端仓库 <code>origin</code> 中。</p></blockquote><h3 id="%E5%88%9B%E5%BB%BA%E7%89%B9%E6%80%A7%E5%88%86%E6%94%AF" tabindex="-1">创建特性分支 <a class="header-anchor" href="#%E5%88%9B%E5%BB%BA%E7%89%B9%E6%80%A7%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h3><p>开始新特性开发工作之前，首先基于最新的 <code>dev</code> 分支创建一个特性分支。</p><h3 id="%E5%90%88%E5%85%A5-dev-%E5%88%86%E6%94%AF" tabindex="-1">合入 <code>dev</code> 分支 <a class="header-anchor" href="#%E5%90%88%E5%85%A5-dev-%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h3><p>特性开发完成后，对应的特性分支应当被合入到 <code>dev</code> 分支当中，并在合入后删除。合入时最好指定 <code>--no-ff</code> 标志，可以避免丢失此特性分支的历史信息。对比如下：</p><p><img src="/images/git-flow/merge-without-ff@2x.png" alt="对比"></p><p>第二种情况下，难以看出哪些提交属于特性开发，如果要回退就更困难了。相反，如果使用了 <code>--no-ff</code> 标志就会简单得多。虽然这样会产生许多空的提交记录，但是得远大于失。</p><h2 id="%E5%8F%91%E5%B8%83%E5%88%86%E6%94%AF" tabindex="-1">发布分支 <a class="header-anchor" href="#%E5%8F%91%E5%B8%83%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h2><p>创建自：</p><p><code>dev</code></p><p>必须合入：</p><p><code>dev</code> 和 <code>main</code></p><p>分支命名规则：</p><p><code>release-*</code></p><p>发布分支用于为生产发布做准备，可以在此进行最后的完善和收尾工作，例如修复一些 Bug 或时更新版本号等。通过在发布分支上进行这些工作，可以保持一个“干净”的 <code>dev</code> 分支。</p><p>当 <code>dev</code> 分支（几乎）可以作为一个新的发布时，就是创建发布分支的时候。在这个时候，所有准备即将发布的特性都已经及时合入到 <code>dev</code> 分支，反之，预期以后发布的特性则不应该被合入。</p><p>发布分支被创建<strong>之后</strong>，此发布才会被指定一个版本号。同时，<code>dev</code> 分支自此反映的则是下一次发布所包含的变更，并且直到下一个发布分支被创建时才能明确下一次发布的版本号是什么。</p><h3 id="%E5%88%9B%E5%BB%BA%E5%8F%91%E5%B8%83%E5%88%86%E6%94%AF" tabindex="-1">创建发布分支 <a class="header-anchor" href="#%E5%88%9B%E5%BB%BA%E5%8F%91%E5%B8%83%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h3><p>发布分支创建自 <code>dev</code> 分支。例如当前生产环境的版本号是 1.1.5，而我们准备发布一个新的版本。当前 <code>dev</code> 分支已经准备好作为新版本，我们决定新版本的版本号是 1.2.0（而不是 1.1.6 或是 2.0.0），因此我们基于 <code>dev</code> 分支创建了一个名为 <code>release-1.2.0</code> 的分支。</p><p>分支创建完成后，即可切换到此分支，修改版本号（例如 package.json 以及 package-lock.json、pom.xml 等），然后提交。</p><p>可以在此分支修复一些 Bug，做一些小改动，但是严禁直接添加大型特性。大型特性只能合入 <code>dev</code> 分支，然后等待下一次发布。</p><h3 id="%E7%BB%93%E6%9D%9F%E5%8F%91%E5%B8%83%E5%88%86%E6%94%AF" tabindex="-1">结束发布分支 <a class="header-anchor" href="#%E7%BB%93%E6%9D%9F%E5%8F%91%E5%B8%83%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h3><p>当发布分支准备好成为一个真正的发布时，还需要完成一系列工作。首先，发布分支应被合入到 <code>main</code> 分支（这是因为 <code>main</code> 分支上的每一个提交都应该代表着一次版本发布，切记）。然后，为此次合并提交打一个标签以便后续查阅历史版本。最后，将发布分支也合入到 <code>dev</code> 分支，如此发布分支上的所有变更都可以包含在后续的版本中。</p><blockquote><p>译者注：使用 GitLab 时，合并操作一般通过 Merge Request 完成。</p></blockquote><p>所有工作都完成后，就可以删除掉此发布分支了。</p><h2 id="%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%86%E6%94%AF" tabindex="-1">热更新分支 <a class="header-anchor" href="#%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h2><p>创建自：</p><p><code>main</code></p><p>必须合入：</p><p><code>dev</code> 或 <code>release-*</code> 和 <code>main</code></p><p>分支命名规则：</p><p><code>hotfix-*</code></p><p><img src="/images/git-flow/hotfix-branches@2x.png" alt="hotfix-branches"></p><p>热更新分支和发布分支相近，它们都意味着一次新的生产环境版本发布，区别在于热更新并不是规划好的。当生产环境版本有严重问题需要立即修改时，则应该基于此版本创建一个热更新分支。</p><p>热更新分支的精髓在于其他开发人员在 <code>dev</code> 分支上的工作仍然可以继续。</p><h3 id="%E5%88%9B%E5%BB%BA%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%86%E6%94%AF" tabindex="-1">创建热更新分支 <a class="header-anchor" href="#%E5%88%9B%E5%BB%BA%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h3><p>热更新分支创建自 <code>main</code> 分支。例如当前生产环境版本号是 1.2.0，有一些问题需要紧急修复，而此时 <code>dev</code> 分支并不稳定，因此我们可以创建一个热更新分支。</p><p>类似于发布分支，我们也需要修改版本号并提交。</p><h3 id="%E7%BB%93%E6%9D%9F%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%86%E6%94%AF" tabindex="-1">结束热更新分支 <a class="header-anchor" href="#%E7%BB%93%E6%9D%9F%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%86%E6%94%AF" aria-hidden="true">#</a></h3><p>热更新分支需要被合入到 <code>main</code> 和 <code>dev</code>，这和发布分支完全一样。但也有一个例外，即当前有一个发布分支。这种情况下，热更新分支应被合入到发布分支而不是 <code>dev</code> 分支。如此一来，此次修改会立刻被包含在下一个发布中，避免在发布分支合入 <code>main</code> 时可能被覆盖。同时，发布分支最终会合入 <code>dev</code> 分支。</p><p>所有工作都完成后，就可以删除掉此热更新分支了。</p><!--]--></div></article><!--]--></main><!--]--></div></body></html>